CREATE OR REPLACE FUNCTION notify_elasticsearch()
RETURNS TRIGGER AS $$
BEGIN
    PERFORM pg_notify('elasticsearch_channel', '{"id": ' || NEW.id || ',"operation": "' || TG_OP || '"}');
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER product_changes
AFTER INSERT OR UPDATE OR DELETE ON products
FOR EACH ROW
EXECUTE FUNCTION notify_elasticsearch();