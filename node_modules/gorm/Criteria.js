//https://docs.jboss.org/hibernate/orm/3.5/api/org/hibernate/Criteria.html
((CriteriaBuilder,shell)=>{
  class _{
    constructor(domain,sessionFactory){
         this.domain=domain;
         this.sessionFactory=sessionFactory;
         this.others=Array.from(arguments).slice(2);
    }
    list(arrow){
       if(!arrow){
         return this.domain.findAll();
       }else{
         let nw=_.now();
         return this.sessionFactory.getDB(this.domain).filter((rw)=>{
           rw[`_$$$_${nw}`]=new CriteriaBuilder(rw);
           arrow.delegate(rw[`_$$$_${nw}`])();
           return rw[`_$$$_${nw}`].result() & delete rw[`_$$$_${nw}`];

         })
       }
    };

    static now(){
    let hrTime=process.hrtime()
     switch (arguments[0]) {
       case 'milli':return hrTime[0] * 1000 + hrTime[1] / 1000000;
       case 'micro':return hrTime[0] * 1000000 + hrTime[1] / 1000;
       case 'nano':return hrTime[0] * 1000000000 + hrTime[1] ;
        break;
       default:return hrTime[0] * 1000000000 + hrTime[1] ;

       }
    }

  }


  module.exports=_;
})(require('./CriteriaBuilder.js'),require('child_process').execSync)
